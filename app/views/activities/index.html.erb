<% @activities.map do |a|
  if a[:audited_changes][:sender_id]
    sender = User.find(a[:audited_changes][:sender_id])
    receiver = User.find(a[:audited_changes][:receiver_id])
    a[:audited_changes][:sender_receiver_link] = 'Sender: ' + link_to(sender.is_a?(Array) ? sender.last : sender, sender) +
                               ' > ' + 'Receiver: ' + link_to(receiver.is_a?(Array) ? receiver.last : receiver, receiver)
  end

  if a[:auditable_type] == 'Contract'
    seller = User.find(a[:audited_changes][:seller_id])
    buyer = User.find(a[:audited_changes][:buyer_id])
    a[:audited_changes][:seller_buyer_link] = 'Seller: ' + link_to(seller, seller) + ' > ' + 'Buyer: ' + link_to(buyer, buyer)
  end
end %>

<%= javascript_tag do %>
  var activityData = <%= @activities.to_json.html_safe %>;
<% end %>
<table id="public_activities" class="table table-bordered table-condensed" cellpadding="0" cellspacing="0" border="0">
  <thead>
    <tr>
      <th><%=t 'Operation type' %></th>
      <th><%=t 'Model type' %></th>
      <th><%=t 'Model text' %></th>
      <th><%=t 'Owner' %></th>
      <th><%=t 'Date' %></th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
